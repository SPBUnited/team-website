<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Glazov Yuri">
        <link rel="canonical" href="https://spbunited.ru/software/algorithms/bang_bang/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Построение "Bang-bang" траекторий движения между двумя точками для футбола роботов - SPbUnited</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">SPbUnited</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Основное</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Устройство робота <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../hardware/construction/" class="dropdown-item">Конструкция</a>
</li>
                                    
<li>
    <a href="../../../hardware/electronics/" class="dropdown-item">Электроника</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Программное обеспечение <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../programs/" class="dropdown-item">Используемые программы</a>
</li>
                                    
<li>
    <a href="../../strategy/" class="dropdown-item">Стратегия игры</a>
</li>
                                    
<li>
    <a href="../" class="dropdown-item">Алгоритмы</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../../links/" class="nav-link">Ссылки</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-light">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#bang-bang" class="nav-link">Построение "Bang-bang" траекторий движения между двумя точками для футбола роботов</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#1" class="nav-link">1. Длинные траектории, случай "Призма"</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#11" class="nav-link">1.1 Постановка задачи</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#12" class="nav-link">1.2 Реализация</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#13" class="nav-link">1.3 Анализ ответа</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#2" class="nav-link">2. Короткие траектории, случай "Треугольник"</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#21" class="nav-link">2.1 Постановка задачи</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#22" class="nav-link">2.2 Реализация</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#23" class="nav-link">2.3 Анализ ответа</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#3" class="nav-link">3. Увеличение дискретизации перед троичным поиском</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="bang-bang">Построение "Bang-bang" траекторий движения между двумя точками для футбола роботов</h1>
<blockquote>
<p><strong><em>Bang-bang</em></strong> (англ. "двухпозиционная") <em>траектория</em> - траектория, во время движения по которой вектор ускорения имеет два возможных значения</p>
</blockquote>
<h1 id="1">1. Длинные траектории, случай "Призма"</h1>
<p>Название обусловлено видом графика зависимости проекций скорости на координатные оси от времени</p>
<p><img alt="Graphs with projection" src="projection_graph_trapez.png" /></p>
<p>Как мы видим, обе проекции скорости на оси меняются одновременно</p>
<h2 id="11">1.1 Постановка задачи</h2>
<p>Робот сначала разгоняется c начальной скорости <script type="math/tex">\vec v_1</script> до максимальной скорости <script type="math/tex">v</script> с ускорением <script type="math/tex">\vec a_1</script> за время <script type="math/tex">t_1</script>, после едет с максимальной скоростью <script type="math/tex">\vec v</script> время <script type="math/tex">t</script> и тормозит с ускорением <script type="math/tex">\vec a_2</script> за время <script type="math/tex">t_2</script> до конечной скорости <script type="math/tex">\vec v_2</script>. За всё движение робот перемещается на <script type="math/tex">\Delta \vec r</script>.</p>
<ul>
<li>Дано: <script type="math/tex">a_m</script> (модуль максимального ускорения), <script type="math/tex">v_m</script> (модуль максимальной скорости), <script type="math/tex">\vec v_1, \vec v_2, \Delta \vec r</script>
</li>
<li>Найти: <script type="math/tex">\vec a_1, \vec a_2, \vec v</script> (восстановить, зная модули), <script type="math/tex">t</script>
</li>
</ul>
<h2 id="12">1.2 Реализация</h2>
<p><img alt="Choosing an angle" src="spinning_trapez.gif" /> </p>
<p>Красные участки - разгон; синий участок - постоянная скорость; фиолетовые точки - начало и конец.</p>
<p>Поиск будем производить "вращая" вектор <script type="math/tex">v</script>. Остальные неизвестные восстановим из формул (аналогично для <script type="math/tex">t_2, \vec a_2</script>):
<script type="math/tex; mode=display">\vec a_1 = (\vec v - \vec v_1) * t_1</script>
<script type="math/tex; mode=display">t_1 = \frac{a_m}{|\vec v - \vec v_1|}</script>
<script type="math/tex; mode=display">\vec a_1 = a_m * \frac{\vec v - \vec v_1}{|\vec v - \vec v_1|}</script>
<script type="math/tex; mode=display">t = \frac{|\Delta \vec r - (\vec v_1 + \vec v) * t_1 / 2 - (\vec v_2 + \vec v) * t_2 / 2|}{v_m}</script>
</p>
<p>Для получения <script type="math/tex">t</script> разделим длину прямого участка (всё перемещение <script type="math/tex">\Delta \vec r</script> без перемещения при разгоне/торможении) на скорость его прохождения</p>
<p>Направление вектора <script type="math/tex">v</script> находим <em>троичным поиском (он же тернарный)</em>. Для этого строим траекторию используя промежуточное значение <script type="math/tex">v</script>, и считаем расстояние от конца получившейся траектории до необходимой конечной точки. Именно это расстояние мы будем стремиться минимизировать.</p>
<p>
<script type="math/tex; mode=display">(\vec v_1 + \vec v)*t_1/2 + \vec v*t + (\vec v_2+\vec v)*t_2/2 \to \Delta \vec r</script>
</p>
<p>Переберём 10 значений и вокруг минимального из них будем искать 0. Это необходимо для того, чтобы троичный поиск не остался в локальном минимуме. Троичный поиск ведём до тех пор, пока промежуток возможного угла не окажется малым (нуля это расстояние никогда не достигнет)</p>
<h2 id="13">1.3 Анализ ответа</h2>
<p>Если конечное расстояние оказалось малым, то траектория найдена и мы можем смело возвращать её роботу или выводить на экран. Если же расстояние явно показывает, что траекторию построить не удалось, то на это есть две причины:</p>
<ul>
<li>траектория с достижением максимальной скорости существует, но мы не смогли её обнаружить</li>
<li>такую траекторию построить невозможно, то есть общее перемещение робота мало и у нас нет возможности разогнаться до максимальной скорости</li>
</ul>
<p><strong>Первый случай</strong> скучный, нужно лишь перезапустить алгоритм, увеличив количество перебираемый значений перед троичным поиском. Пока не будем тратить на него время работы программы и перезапустим код в случае если не удастся найти путь другими методами тоже. <strong>Второй случай</strong> уже требует новый алгоритм для создания траекторий, который мы рассмотрим далее</p>
<h1 id="2">2. Короткие траектории, случай "Треугольник"</h1>
<p>На этот раз название вновь связано с видом графика зависимости проекций скорости на координатные оси от времени</p>
<p><img alt="Graphs with projection" src="projection_graph_triangle.png" /></p>
<p>На этот раз на графике нет прямого участка из-за того, что робот не успевает разогнаться до максимальной скорости.</p>
<h2 id="21">2.1 Постановка задачи</h2>
<p>Робот разгоняется c начальной скорости <script type="math/tex">\vec v_1</script> до некоторой скорости <script type="math/tex">v</script> с ускорением <script type="math/tex">\vec a_1</script> за время <script type="math/tex">t_1</script> и сразу тормозит с ускорением <script type="math/tex">\vec a_2</script> за время <script type="math/tex">t_2</script> до конечной скорости <script type="math/tex">\vec v_2</script>. За всё движение робот также перемещается на <script type="math/tex">\Delta \vec r</script>.</p>
<ul>
<li>Дано: <script type="math/tex">a_m</script> (модуль максимального ускорения), <script type="math/tex">\vec v_1, \vec v_2, \Delta \vec r</script>
</li>
<li>Найти: <script type="math/tex">\vec a_1, \vec a_2</script> (восстановить, зная модули) и <script type="math/tex">\vec v</script>
</li>
</ul>
<p>Задача усложнилась с предыдущего случая тем, что теперь мы не знаем модуль промежуточной скорости. </p>
<h2 id="22">2.2 Реализация</h2>
<p><img alt="Choosing an angle" src="spinning_triangle_%28fix_speed%29.gif" /> </p>
<p>Перебор угла для заданного модуля скорости. Красные участки - разгон; фиолетовые точки - начало и конец.</p>
<p>Поиск будем производить не только "вращая" вектор <script type="math/tex">v</script>, но и перебирая модуль его скорости. Ускорения и время восстановим из вышеописанных формул (см. п. 1.2)</p>
<p>Будем перебирать модуль <script type="math/tex">\vec v</script> и отдавать его тому же алгоритму, что считал расстояние до цели для "трапеции"</p>
<p>Для поиска модуля также перебираем 10 значений на промежутке <script type="math/tex">[0, v_m]</script> и выполняем поиск вокруг наименьшего</p>
<h2 id="23">2.3 Анализ ответа</h2>
<p>В случае нахождения пути заканчиваем алгоритм, но если путь не нашёлся, то вновь возвращаемся к двум случаям
* траектория без достижения максимальной скорости существует, но мы не смогли её обнаружить
* такую траекторию построить невозможно, то есть алгоритм с достижением максимальной скорости должен был построить маршрут</p>
<p>В обоих случаях нам необходимо прогнать оба алгоритма ещё раз, но рассматривая больше значений в начале, чтобы точно найти значение около минимума, которое явно будет меньше остальных.</p>
<h1 id="3">3. Увеличение дискретизации перед троичным поиском</h1>
<p>Для увеличения числа значений, которые мы будем перебирать перед троичным поиском будем передавать их число <script type="math/tex">n</script> в качестве параметра функции. Если после первого прогона оба алгоритма для длинных и коротких траекторий не смогли найти траекторию, запустим первый из них увеличив <script type="math/tex">n</script> на 10. Так алгоритмы смогут сделать ещё один пробег и найти маршрут. Больше двух раз прогонять все эти ресурсозатратные алгоритмы не имеет смысла, поэтому возвращаем <code>None</code></p>
<p>Важно отметить, что это является решением проблемы невозможности построить путь, поэтому об оптимальности речи не идет. </p>
<!-- # 4. Примеры других команд
В нашей реализации меняется именно вектор ускорения, а не его проекция на оси. Это увеличивает количество вычислений, но уменьшает время прохождения по полученной траектории. Также при пересчёте траектории во время движения по ней, она не изменится, так как является оптимальной для такой реализации.

<font color="red"> TODO Добавить примеры других команд</font> --></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
